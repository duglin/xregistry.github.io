<h1>Message Definitions Registry Service - Version 1.0-rc1</h1>

<h2>Abstract</h2>

<p>This specification defines a message and event catalog extension to the
xRegistry document format and API <a href="../core/spec.md">specification</a>.</p>

<h2>Table of Contents</h2>

<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#notations-and-terminology">Notations and Terminology</a>

<ul>
<li><a href="#notational-conventions">Notational Conventions</a></li>
<li><a href="#terminology">Terminology</a></li>
</ul></li>
<li><a href="#message-definitions-registry">Message Definitions Registry</a>

<ul>
<li><a href="#message-definition-groups">Message Definition Groups</a></li>
<li><a href="#message-definitions">Message Definitions</a></li>
</ul></li>
</ul>

<h2>Overview</h2>

<p>This specification defines a message and event catalog extension to the
xRegistry document format and API <a href="../core/spec.md">specification</a>. The purpose
of the catalog is to provide a machine-readable definitions for message and event
envelopes and logical grouping of related messages and events.</p>

<p>Managing the description of the payloads of those messages and events is not in
scope, but delegated to the <a href="../schema/spec.md">schema registry extension</a> for
xRegistry. Schemas are linked to messages and event declarations by a URI
reference.</p>

<p>For easy reference, the JSON serialization of a Message Registry adheres to
this form:</p>

<pre><code class="language-yaml">{
  &quot;specversion&quot;: &quot;STRING&quot;,
  &quot;registryid&quot;: &quot;STRING&quot;,
  &quot;self&quot;: &quot;URL&quot;,
  &quot;shortself&quot;: &quot;URL&quot;,
  &quot;xid&quot;: &quot;XID&quot;,
  &quot;epoch&quot;: UINTEGER,
  &quot;name&quot;: &quot;STRING&quot;, ?
  &quot;description&quot;: &quot;STRING&quot;, ?
  &quot;documentation&quot;: &quot;URL&quot;, ?
  &quot;labels&quot;: {
    &quot;STRING&quot;: &quot;STRING&quot; *
  }, ?
  &quot;createdat&quot;: &quot;TIMESTAMP&quot;,
  &quot;modifiedat&quot;: &quot;TIMESTAMP&quot;,

  &quot;model&quot;: { ... }, ?

  &quot;messagegroupsurl&quot;: &quot;URL&quot;,
  &quot;messagegroupscount&quot;: UINTEGER,
  &quot;messagegroups&quot;: {
    &quot;KEY&quot;: {                                    # messagegroupid
      &quot;messagegroupid&quot;: &quot;STRING&quot;,               # xRegistry core attributes
      &quot;self&quot;: &quot;URL&quot;,
      &quot;shortself&quot;: &quot;URL&quot;,
      &quot;xid&quot;: &quot;XID&quot;,
      # Start of default Version's attributes
      &quot;epoch&quot;: UINTEGER,
      &quot;name&quot;: &quot;STRING&quot;, ?
      &quot;description&quot;: &quot;STRING&quot;, ?
      &quot;documentation&quot;: &quot;URL&quot;, ?
      &quot;labels&quot;: { &quot;STRING&quot;: &quot;STRING&quot; * }, ?
      &quot;createdat&quot;: &quot;TIMESTAMP&quot;,
      &quot;modifiedat&quot;: &quot;TIMESTAMP&quot;,

      &quot;envelope&quot;: &quot;STRING&quot;, ?                  # e.g. CloudEvents/1.0
      &quot;protocol&quot;: &quot;STRING&quot;, ?                  # e.g. HTTP/1.1

      &quot;messagesurl&quot;: &quot;URL&quot;,
      &quot;messagescount&quot;: UINTEGER,
      &quot;messages&quot; : {
        &quot;KEY&quot;: {                               # messageid
          &quot;messageid&quot;: &quot;STRING&quot;,               # xRegistry core attributes
          &quot;versionid&quot;: &quot;STRING&quot;,
          &quot;self&quot;: &quot;URL&quot;,
          &quot;shortself&quot;: &quot;URL&quot;,
          &quot;xid&quot;: &quot;XID&quot;,
          # Start of default Version's attributes
          &quot;epoch&quot;: UINTEGER,
          &quot;name&quot;: &quot;STRING&quot;, ?
          &quot;description&quot;: &quot;STRING&quot;, ?
          &quot;documentation&quot;: &quot;URL&quot;, ?
          &quot;labels&quot;: { &quot;STRING&quot;: &quot;STRING&quot; * }, ?
          &quot;createdat&quot;: &quot;TIMESTAMP&quot;,
          &quot;modifiedat&quot;: &quot;TIMESTAMP&quot;,
          &quot;ancestor&quot;: &quot;STRING&quot;,

          &quot;deprecated&quot;: {
            &quot;effective&quot;: &quot;TIMESTAMP&quot;, ?
            &quot;removal&quot;: &quot;TIMESTAMP&quot;, ?
            &quot;alternative&quot;: &quot;URL&quot;, ?
            &quot;docs&quot;: &quot;URL&quot;?
          }, ?

          &quot;basemessageurl&quot;: &quot;URL&quot;, ?           # Message being extended

          &quot;envelope&quot;: &quot;STRING&quot;, ?              # e.g. CloudEvents/1.0
          &quot;envelopemetadata&quot;: {
            &quot;STRING&quot;: JSON-VALUE *

            # CloudEvents/1.0 &quot;envelope&quot; the &quot;envelopemetadata&quot; is of the form:
            &quot;STRING&quot;: {
              &quot;type&quot;: &quot;TYPE&quot;, ?
              &quot;value&quot;: ANY, ?
              &quot;required&quot;: BOOLEAN              # Default=false
            } *
          }, ?
          &quot;envelopeoptions&quot;: {
            &quot;STRING&quot;: JSON-VALUE *
          }, ?

          &quot;protocol&quot;: &quot;STRING&quot;, ?              # e.g. HTTP/1.1
          &quot;protocoloptions&quot;: { ... }, ?

          &quot;dataschemaformat&quot;: &quot;STRING&quot;, ?
          &quot;dataschema&quot;: ANY, ?
          &quot;dataschemauri&quot;: &quot;URI&quot;, ?
          &quot;datacontenttype&quot;: &quot;STRING&quot;, ?
          # End of default Version's attributes

          &quot;metaurl&quot;: &quot;URL&quot;,
          &quot;meta&quot;: { ... }, ?
          &quot;versionsurl&quot;: &quot;URL&quot;,
          &quot;versionscount&quot;: UINTEGER,
          &quot;versions&quot;: { ... } ?
      } ?
    } *
  } ?
}
</code></pre>

<h2>Notations and Terminology</h2>

<h3>Notational Conventions</h3>

<p>The key words &ldquo;MUST&rdquo;, &ldquo;MUST NOT&rdquo;, &ldquo;REQUIRED&rdquo;, &ldquo;SHALL&rdquo;, &ldquo;SHALL NOT&rdquo;, &ldquo;SHOULD&rdquo;,
&ldquo;SHOULD NOT&rdquo;, &ldquo;RECOMMENDED&rdquo;, &ldquo;MAY&rdquo;, and &ldquo;OPTIONAL&rdquo; in this document are to be
interpreted as described in <a href="https://tools.ietf.org/html/rfc2119">RFC 2119</a>.</p>

<p>For clarity, OPTIONAL attributes (specification-defined and extensions) are
OPTIONAL for clients to use, but the servers&rsquo; responsibility will vary.
Server-unknown extension attributes MUST be silently stored in the backing
datastore. Specification-defined, and server-known extension, attributes MUST
generate an error if corresponding feature is not supported or enabled.
However, as with all attributes, if accepting the attribute would result in a
bad state (such as exceeding a size limit, or results in a security issue),
then the server MAY choose to reject the request.</p>

<p>In the pseudo JSON format snippets <code>?</code> means the preceding attribute is
OPTIONAL, <code>*</code> means the preceding attribute MAY appear zero or more times,
and <code>+</code> means the preceding attribute MUST appear at least once. The presence
of the <code>#</code> character means the remaining portion of the line is a comment.
Whitespace characters in the JSON snippets are used for readability and are
not normative.</p>

<h3>Terminology</h3>

<p>This specification defines the following terms:</p>

<h4>Message and Event</h4>

<p>A <strong>message</strong> is a transport wrapper around a <strong>message body</strong> (interchangeably
referred to as payload) that is decorated with <strong>metadata</strong>. The metadata
describes the message body without an intermediary having to inspect it and
carries further information useful for identification, routing, and dispatch.</p>

<p>In this specification, <strong>message</strong> is an umbrella term that refers to all kinds
of messages as well as to <strong>events</strong> as a special form of messages.</p>

<p>The definition of <a href="https://github.com/cloudevents/spec/blob/main/cloudevents/spec.md#message">message</a> from the CloudEvents specification applies.</p>

<h4>Envelopes and Protocols</h4>

<p>An <strong>envelope</strong> is a transport protocol-independent message metadata convention.
The <a href="https://github.com/cloudevents/spec/blob/main/cloudevents/spec.md">CNCF CloudEvents</a> specification is an example of a message
envelope and is the only envelope explicitly defined in this specification.</p>

<p>A similar transport protocol-independent message metadata convention is, for
example, the <a href="https://www.w3.org/TR/soap12-part1/">W3C SOAP 1.2 envelope</a> for which support could be added by
an extension.</p>

<p>This specification uses <strong>protocol</strong> to refer to a transport protocol-specific
message metadata convention. When a known protocol is explicitly specified for a
message definition, the &ldquo;protocoloptions&rdquo; section MAY contain constraints for
the protocol-specific metadata.</p>

<h2>Message Definitions Registry</h2>

<p>The Message Definitions Registry (or &ldquo;Message Catalog&rdquo;) is a registry of
metadata definitions for messages and events. The entries in the registry
describe constraints for the metadata of messages and events, for instance the
concrete values and patterns for the <code>type</code>, <code>source</code>, and <code>subject</code> attributes
of a CloudEvent.</p>

<p>Message definitions can be used in various contexts. A code generator for
message producers can be informed, which properties or headers have to be set,
and which data types, values, or patterns are expected to produce a conformant
message. A message consumer can use the definitions to validate incoming
messages and to extract the metadata for routing or processing.</p>

<p>A message group is a collection of message definitions that are related to
each other in some application-specific way. For instance, a message group
can be used to group all events raised by a particular application module or by
a particular role of an application protocol exchange pattern.</p>

<p>All message definitions MUST be defined inside message groups.</p>

<p>A message processor for a messaging or eventing channel can use a message group
and its contained message definitions to match incoming messages to the declared
message definitions and determine whether an incoming message conforms to
the expected metadata constraints. If a conformant message has been identified,
the processor might then use the linked schema to handle the message body. This
is especially useful in scenarios where the message itself does not contain a
schema hint or even content type information as it is the case, for instance, in
MQTT 3.1.1.</p>

<p>Whether a message is conformant to a message definition is determined by the
message processor and its implementation-specific rules. Conformance rules are
out of the scope of this specification.</p>

<p>The <a href="../endpoint/spec.md">Endpoint Registry</a> is a related registry that leans on
this concept and allows associating one or more message definition groups with
an endpoint, thus effectively defining a contract for the endpoint. An &ldquo;endpoint&rdquo;
as defined in that specification is also a message definition group in itself,
with the message definitions following the rules of this specification.</p>

<h2>Message Definition Registry Model</h2>

<p>The formal xRegistry extension model of the Message Definitions Registry
resides in the <a href="model.json">model.json</a> file.</p>

<h3>Message Definition Groups</h3>

<p>The Group (GROUP) name is <code>messagegroups</code>. The type of a group is
<code>messagegroup</code>.</p>

<p>The following attributes are defined for the <code>messagegroup</code> object in addition
to the xRegistry-defined core
<a href="../core/spec.md#attributes-and-extensions">attributes</a>:</p>

<h4><code>envelope</code> (Message Group)</h4>

<ul>
<li>Type: String</li>
<li>Description: Identifies the common, transport protocol independent message
metadata format. Message metadata envelopes are referenced by name and version
as <code>{NAME}/{VERSION}</code>. This specification defines a set of common
<a href="#metadata-envelopes">metadata envelope names</a> that MUST be used for the given
envelopes, but applications MAY define extensions for other envelopes on their
own. All definitions inside a group MUST use this same envelope.</li>
<li>Constraints:

<ul>
<li>At least one of <code>envelopemetadata</code> and <code>protocol</code> MUST be specified.</li>
<li>If present, MUST be a non-empty string</li>
<li>If present, MUST follow the naming convention <code>{NAME}/{VERSION}</code>, whereby
<code>{NAME}</code> is the name of the metadata envelope and <code>{VERSION}</code> is the
version of the metadata envelope.</li>
</ul></li>
<li>Examples:

<ul>
<li><code>CloudEvents/1.0</code></li>
</ul></li>
</ul>

<h4><code>protocol</code> (Message Group)</h4>

<ul>
<li>Type: String</li>
<li>Description: Identifies a transport protocol to be used for this Message.
Protocols are referenced by name and version as <code>{NAME}/{VERSION}</code>. This
specification defines a set of common <a href="#message-protocols">message protocol
names</a> that MUST be used for the given protocols, but
applications MAY define extensions for other protocols on their own. All
messages inside a group MUST use this same protocol.</li>
<li>Constraints:

<ul>
<li>At least one of <code>envelopemetadata</code> and <code>protocol</code> MUST be specified.</li>
<li>If present, MUST be a non-empty string</li>
<li>If present, MUST follow the naming convention <code>{NAME}</code> or
<code>{NAME}/{VERSION}</code>, whereby <code>{NAME}</code> is the name of the protocol and
<code>{VERSION}</code> is the version of protocol. The version is REQUIRED if multiple,
mutually incompatible versions of the protocol exist and protocol options
differ between versions.</li>
</ul></li>
<li>Examples:

<ul>
<li><code>MQTT/3.1.1</code></li>
<li><code>AMQP/1.0</code></li>
<li><code>KAFKA</code></li>
</ul></li>
</ul>

<h3>Message Definitions</h3>

<p>The resource (RESOURCE) collection name inside <code>messagegroup</code> is
<code>messages</code>. The resource name is <code>message</code>.</p>

<p>Different from schemas, message definitions do not contain a
version history. If the metadata of two messages differs, they are considered
different messages.</p>

<p>When <a href="https://cloudevents.io">CloudEvents</a> is being used for a particular
message, it is RECOMMENDED that the message&rsquo;s <code>messageid</code> attribute be the
same as the <a href="https://github.com/cloudevents/spec/blob/main/cloudevents/spec.md#type">CloudEvents <code>type</code>
attribute</a>. Doing so makes for easier management of the meta-model by correlating
the look-up value (id) of messages with their related events.</p>

<p>The following extensions are defined for the <code>message</code> Resource in addition to
the core xRegistry Resource
<a href="../core/spec.md#attributes-and-extensions">attributes</a>:</p>

<h4><code>deprecated</code></h4>

<ul>
<li><p>Type: Object containing the following properties:</p>

<ul>
<li><p><code>effective</code>
An OPTIONAL property indicating the time when the message entered, or will
enter, a deprecated state. The date MAY be in the past or future. If this
property is not present the message is already in a deprecated state.
If present, this MUST be an <a href="https://tools.ietf.org/html/rfc3339">RFC3339</a> timestamp.</p></li>

<li><p><code>removal</code>
An OPTIONAL property indicating the time when the message MAY be removed.
The message MUST NOT be removed before this time. If this property is not
present then client can not make any assumption as to when the message
might be removed. Note: as with most properties, this property is mutable.
If present, this MUST be an <a href="https://tools.ietf.org/html/rfc3339">RFC3339</a> timestamp and MUST NOT be
sooner than the <code>effective</code> time if present.</p></li>

<li><p><code>alternative</code>
An OPTIONAL property specifying the URL to an alternative message the
client can consider as a replacement for this message. There is no
guarantee that the referenced message is an exact replacement, rather the
client is expected to investigate the message to determine if it is
appropriate.</p></li>

<li><p><code>docs</code>
An OPTIONAL property specifying the URL to additional information about
the deprecation of the message. This specification does not mandate any
particular format or information, however some possibilities include:
reasons for the deprecation or additional information about likely
alternative messages. The URL MUST support an HTTP GET request.</p></li>
</ul></li>
</ul>

<p>Note that an implementation is not mandated to use this attribute in
  advance of removing an message, but is it RECOMMENDED that they do so.
- Constraints:
  - OPTIONAL
- Examples:
  - <code>&quot;deprecated&quot;: {}</code>
  - 
<pre><code>
    &quot;deprecated&quot;: {
      &quot;removal&quot;: &quot;2030-12-19T00:00:00-00:00&quot;,
      &quot;alternative&quot;: &quot;https://example.com/messages/popped&quot;
    }
</code></pre>
</p>

<h4><code>basemessageurl</code></h4>

<ul>
<li>Type: URI-reference</li>
<li>Description: if present, the URL points to a message definition that is the
base for this message definition. By following the URL, the base message
can be retrieved and extended with the properties of this message. This is
useful for defining variants of messages that only differ in minor aspects to
avoid repetition, or messages that only have a <code>envelope</code> with associated
<code>envelopemetadata</code> to be bound to various protocols.
Attributes defined in this message fully override the attributes of the base
message.</li>
<li>Constraints:

<ul>
<li>OPTIONAL</li>
<li>If present, MUST be a valid URI-reference</li>
<li>If present, MUST point to a resource of type <code>message</code> using JSON Pointer
<a href="https://www.rfc-editor.org/rfc/rfc6901">RFC6901</a> notation.</li>
</ul></li>
</ul>

<h4><code>envelope</code></h4>

<p>Same as the <a href="#envelope-message-group"><code>envelope</code></a> attribute of the
<code>messagegroup</code> object.</p>

<p>Since messages MAY be cross-referenced (&ldquo;borrowed&rdquo;) across message group
boundaries, this attribute is also REQUIRED and MUST be the same as the
<code>envelope</code> attribute of the <code>messagegroup</code> object into which the message is
embedded or referenced.</p>

<p>Illustrating example:</p>

<pre><code class="language-yaml">
&quot;messagegroupsurl&quot;: &quot;...&quot;,
&quot;messagegroupscount&quot;: 2,
&quot;messagegroups&quot;: {
  &quot;com.example.abc&quot;: {
    &quot;messagegroupid&quot;: &quot;com.example.abc&quot;,
    &quot;envelope&quot;: &quot;CloudEvents/1.0&quot;,

    &quot;messagesurl&quot;: &quot;...&quot;,
    &quot;messagescount&quot;: 2,
    &quot;messages&quot;: {
      &quot;com.example.abc.event1&quot;: {
        &quot;messageid&quot;: &quot;com.example.abc.event1&quot;,
        &quot;envelope&quot;: &quot;CloudEvents/1.0&quot;,
         # ... details ...
        }
      },
      &quot;com.example.abc.event2&quot;: {
        &quot;messageid&quot;: &quot;com.example.abc.event1&quot;,
        &quot;envelope&quot;: &quot;CloudEvents/1.0&quot;,
        # ... details ...
      }
  },
  &quot;com.example.def&quot;: {
    &quot;messagegroupid&quot;: &quot;com.example.def&quot;,
    &quot;envelope&quot;: &quot;CloudEvents/1.0&quot;,

    &quot;messagesurl&quot;: &quot;...&quot;,
    &quot;messagescount&quot;: 1,
    &quot;messages&quot;: {
      &quot;com.example.abc.event1&quot;: {
        &quot;uri&quot;: &quot;#/messagegroups/com.example.abc/messages/com.example.abc.event1&quot;,
        # ... details ...
      }
    }
  }
}
</code></pre>

<h4><code>envelopemetadata</code></h4>

<ul>
<li>Type: Object</li>
<li>Description: Describes the metadata constraints for messages of this type. The
content of this property is defined by the message envelope, but all
envelopes use a common schema for the constraints defined for their
metadata headers, properties or attributes.</li>
<li>Constraints:

<ul>
<li>REQUIRED if <code>envelope</code> is specified.</li>
</ul></li>
<li>Examples:

<ul>
<li>See <a href="#metadata-envelopes">Metadata Envelopes</a></li>
</ul></li>
</ul>

<h4><code>envelopeoptions</code></h4>

<p>See <a href="../endpoint/spec.md#envelopeoptions"><code>envelopeoptions</code></a> in the Endpoint
specification.</p>

<h4><code>protocol</code></h4>

<ul>
<li>Same as the <a href="#protocol-message-group"><code>protocol</code></a> attribute of the
<code>messagegroup</code> object.</li>
</ul>

<h4><code>protocoloptions</code></h4>

<ul>
<li>Type: Object</li>
<li>Description: Describes the message constraints for the protocol being used.
The content of this property is defined by the protocol message binding,
but all protocols use a common schema model for the
constraints defined for their metadata headers, properties or attributes.</li>
<li>Constraints:

<ul>
<li>REQUIRED if <code>protocol</code> is specified.</li>
</ul></li>
<li>Examples:

<ul>
<li>See <a href="#message-protocols">Message protocols</a></li>
</ul></li>
</ul>

<h4><code>dataschemaformat</code></h4>

<ul>
<li>Type: String</li>
<li>Description: Identifies the schema format applicable to the message payload,
equivalent to the schema <a href="../schema/spec.md#format">&lsquo;format&rsquo;</a>
attribute.</li>
<li>Constraints:

<ul>
<li>OPTIONAL</li>
<li>If present, MUST be a non-empty string</li>
<li>If present, MUST follow the naming convention <code>{NAME}/{VERSION}</code>, whereby
<code>{NAME}</code> is the name of the schema format and <code>{VERSION}</code> is the version of
the schema format in the format defined by the schema format itself.</li>
</ul></li>
<li>Examples:

<ul>
<li>&lsquo;JSONSchema/draft-07&rsquo;</li>
<li>&lsquo;Avro/1.9.0&rsquo;</li>
<li>&lsquo;Protobuf/3&rsquo;</li>
</ul></li>
</ul>

<h4><code>dataschema</code></h4>

<ul>
<li>Type: Any</li>
<li>Description: Contains the inline schema for the message payload. The schema
format is identified by the <code>dataschemaformat</code> attribute. Equivalent to the
schemaversion
<a href="../schema/spec.md#schema">&lsquo;schema&rsquo;</a> attribute</li>
<li>Constraints:

<ul>
<li>OPTIONAL.</li>
<li>Mutually exclusive with the <code>dataschemauri</code> attribute.</li>
<li>If present, <code>dataschemaformat</code> MUST be present.</li>
</ul></li>
<li>Examples:

<ul>
<li>See <a href="../schema/spec.md#schema-formats">Schema Formats</a></li>
</ul></li>
</ul>

<h4><code>dataschemauri</code></h4>

<ul>
<li>Type: URI-reference</li>
<li>Description: Contains a relative or absolute URI that points to the schema
object to use for the message payload. The schema format is identified by the
<code>dataschemaformat</code> attribute. See
<a href="../schema/spec.md#schema-formats">Schema Formats</a> for details on
how to reference specific schema objects for the message payload. It is not
sufficient for the URI-reference to point to a schema document; it MUST
resolve to a concrete schema object.</li>
<li>Constraints:

<ul>
<li>OPTIONAL.</li>
<li>Mutually exclusive with the <code>dataschema</code> attribute.</li>
<li>If present, <code>dataschemaformat</code> MUST be present.</li>
</ul></li>
</ul>

<h4><code>datacontenttype</code></h4>

<ul>
<li>Type: <code>String</code> per <a href="https://tools.ietf.org/html/rfc2046">RFC 2046</a></li>
<li>Description: Content type of the message payload. This attribute MAY be
duplicative with some other metadata within the message definition. For
example, in the case of using CloudEvents, the <code>envelopemetadata</code> attribute
might include the <code>datacontenttype</code> attribute. This possible duplication
of data is expected so as to allow for a more consistent, and easy, discovery
of the message&rsquo;s format. This means that if this information does appear in
more than one location within the message metadata they MUST all have the
same values.</li>
</ul>

<p>Note that when an <code>envelope</code> is defined for a message and the data of
  interest is serialized as being nested within the envelope (e.g.
  CloudEvents &ldquo;structured&rdquo; mode), then this attribute MUST be the content type
  of the message envelope and not of the data nested within the envelope.</p>

<p>As specified in <a href="https://tools.ietf.org/html/rfc2045">RFC 2045</a>, the media
  type part of the content type MUST be treated in a case-insensitive manner
  by consumers, along with the attribute names in parameters. For example,
  a <code>datacontenttype</code> of <code>text/plain; charset=utf-8</code> MUST be treated in the
  same way as <code>TEXT/Plain; CharSet=utf-8</code>.
- Constraints:
  - OPTIONAL
  - If present, MUST adhere to the format specified in
    <a href="https://tools.ietf.org/html/rfc2046">RFC 2046</a>
- For Media Type examples see
  <a href="http://www.iana.org/assignments/media-types/media-types.xhtml">IANA Media Types</a></p>

<h3>Metadata Envelopes and Message Protocols</h3>

<p>This section defines the metadata envelopes and message protocols that are
directly supported by this specification.</p>

<p>Metadata envelopes lean on a protocol-neutral metadata definition like
CloudEvents. Message protocols lean on a message model definition of a specific
protocol like AMQP or MQTT or Kafka.</p>

<p>A message can use either a metadata <code>envelope</code>, a message <code>protocol</code>, or both.</p>

<p>If a message only uses a metadata <code>envelope</code>, any implicit protocol bindings
defined by the envelope apply. For instance, a message definition that uses the
&ldquo;CloudEvents/1.0&rdquo; envelope but no explicit <code>protocol</code> implicitly applies to all
protocols for which CloudEvents bindings exist, and using the respective
protocol binding rules.</p>

<p>If a message uses both a metadata <code>envelope</code> and a message <code>protocol</code>, the
message binding rules apply over the metadata envelope rules. For instance, if
a message definition uses the &ldquo;CloudEvents/1.0&rdquo; envelope and an &ldquo;AMQP/1.0&rdquo;
protocol, then the implicit protocol bindings of the &ldquo;CloudEvents/1.0&rdquo; envelope
are overridden by the &ldquo;AMQP/1.0&rdquo; protocol rules.</p>

<p>If a message uses only a message <code>protocol</code>, only the metadata constraints
defined by the message <code>protocol</code> rules apply.</p>

<h4>Common properties</h4>

<p>The following properties are common to all messages with
headers/properties/attributes constraints:</p>

<h5><code>description</code></h5>

<ul>
<li>Type: String</li>
<li>Description: A human-readable description of the property.</li>
<li>Constraints:

<ul>
<li>OPTIONAL.</li>
<li>If present, MUST be a non-empty string.</li>
</ul></li>
</ul>

<h5><code>required</code></h5>

<ul>
<li>Type: Boolean</li>
<li>Description: Indicates whether the property is REQUIRED to be present in a
message of this type.</li>
<li>Constraints:

<ul>
<li>OPTIONAL. Defaults MUST be <code>false</code>.</li>
<li>If present, MUST be a boolean value.</li>
</ul></li>
</ul>

<h5><code>specurl</code></h5>

<ul>
<li>Type: URI-reference</li>
<li>Description: Contains a relative or absolute URI that points to the
human-readable specification of the property.</li>
<li>Constraints:

<ul>
<li>OPTIONAL</li>
</ul></li>
</ul>

<h5><code>type</code></h5>

<ul>
<li>Type: String</li>
<li>Description: The type of the property. This is used to constrain the value of
the property.</li>
<li>Constraints:

<ul>
<li>OPTIONAL.</li>
<li>Default value MUST be &ldquo;string&rdquo;.</li>
<li>The valid types are those defined in the <a href="https://github.com/cloudevents/spec/blob/v1.0.2/cloudevents/spec.md#type-system">CloudEvents</a>
core specification, with some additions:

<ul>
<li><code>any</code>: Any type of value, including <code>null</code>.</li>
<li><code>boolean</code>: CloudEvents &ldquo;Boolean&rdquo; type.</li>
<li><code>string</code>: CloudEvents &ldquo;String&rdquo; type.</li>
<li><code>symbol</code>: A <code>string</code> that is restricted to alphanumerical characters and
underscores.</li>
<li><code>binary</code>: CloudEvents &ldquo;Binary&rdquo; type.</li>
<li><code>timestamp</code>: CloudEvents &ldquo;Timestamp&rdquo; type (RFC3339 DateTime)</li>
<li><code>duration</code>: RFC3339 Duration</li>
<li><code>uritemplate</code>: <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1 URI Template</li>
<li><code>uri</code>: CloudEvents &ldquo;URI&rdquo; type (RFC3986 URI)</li>
<li><code>urireference</code>: CloudEvents &ldquo;URI-reference&rdquo; type (RFC3986 URI-reference)</li>
<li><code>number</code>: IEEE754 Double</li>
<li><code>integer</code>: CloudEvents &ldquo;Integer&rdquo; type (RFC 7159, Section 6)</li>
</ul></li>
</ul></li>
</ul>

<h5><code>value</code></h5>

<ul>
<li>Type: Any</li>
<li>Description: The value of the property. With a few exceptions, see below, this
is the value that MUST be literally present in the message for the message to
be considered conformant with this metaschema.</li>
<li>Constraints:

<ul>
<li>OPTIONAL.</li>
<li>If present, MUST be a valid value for the property.</li>
</ul></li>
</ul>

<p>If the <code>type</code> property has the value <code>uritemplate</code>, <code>value</code> MAY contain
placeholders. As defined in <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> (Level 1), the placeholders MUST
be enclosed in curly braces (<code>{</code> and <code>}</code>) and MUST be a valid <code>symbol</code>.
Placeholders that are used multiple times in the same message definition MUST to
represent identical values.</p>

<p>When validating a message property against this value, the placeholders act as
wildcards. For example, the value <code>{foo}/bar</code> would match the value <code>abc/bar</code> or
<code>xyz/bar</code>.</p>

<p>When creating a message based on a metaschema with such a value, the
placeholders MUST be replaced with valid values. For example, the value
<code>{foo}/bar</code> would be replaced with <code>abc/bar</code> or <code>xyz/bar</code> when creating a
message.</p>

<p>If the <code>type</code> property has the value <code>timestamp</code> and the <code>value</code> property is
set to a value of <code>01-01-0000T00:00:00Z</code>, the value MUST be replaced with the
current timestamp when creating a message.</p>

<h4>Metadata Envelopes</h4>

<p>This specification only defines one metadata envelope: &ldquo;CloudEvents/1.0&rdquo;.</p>

<h5>CloudEvents/1.0</h5>

<p>For the &ldquo;CloudEvents/1.0&rdquo; envelope, the
<a href="#envelopemetadata"><code>envelopemetadata</code></a> object contains a property
<code>attributes</code>, which is an object whose properties correspond to the
CloudEvents context attributes.</p>

<p>As with the <a href="https://github.com/cloudevents/spec/blob/main/cloudevents/spec.md">CloudEvents specification</a>, the attributes form a
flat list and extension attributes are allowed. Attribute names are restricted
to lower-case alphanumerical characters without separators.</p>

<p>The base attributes are defined as follows:</p>

<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>specversion</code></td>
<td><code>string</code></td>
</tr>

<tr>
<td><code>id</code></td>
<td><code>string</code></td>
</tr>

<tr>
<td><code>type</code></td>
<td><code>string</code></td>
</tr>

<tr>
<td><code>source</code></td>
<td><code>uritemplate</code></td>
</tr>

<tr>
<td><code>subject</code></td>
<td><code>string</code></td>
</tr>

<tr>
<td><code>time</code></td>
<td><code>timestamp</code></td>
</tr>

<tr>
<td><code>dataschema</code></td>
<td><code>uritemplate</code></td>
</tr>

<tr>
<td><code>datacontenttype</code></td>
<td><code>string</code></td>
</tr>
</tbody>
</table>
<p>The following rules apply to the attribute declarations:</p>

<ul>
<li>All attribute declarations are OPTIONAL. Requirements for absent
definitions are implied by the CloudEvents specification.</li>
<li>The <code>specversion</code> attribute is implied by the message envelope and is
OPTIONAL. If present, it MUST be declared with a <code>string</code> type and set to the
value &ldquo;1.0&rdquo;.</li>
<li>The <code>type</code>, <code>id</code>, and <code>source</code> attributes implicitly have the <code>required</code> flag
set to <code>true</code> and MUST NOT be declared as <code>required: false</code>.</li>
<li>The <code>id</code> attribute&rsquo;s <code>value</code> SHOULD NOT be defined.</li>
<li>The <code>time</code> attribute&rsquo;s <code>value</code> default value MUST be <code>01-01-0000T00:00:00Z</code>
(&ldquo;current time&rdquo;) and SHOULD NOT be declared with a different value.</li>
<li>The <code>datacontenttype</code> attribute&rsquo;s <code>value</code> is inferred from the
<a href="#dataschemaformat"><code>dataschemaformat</code></a> attribute of the message definition
if absent.</li>
<li>The <code>dataschema</code> attribute&rsquo;s <code>value</code> is inferred from the
<a href="#dataschemauri"><code>dataschemauri</code></a> attribute or
<a href="#dataschema"><code>dataschema</code></a> attribute of the message definition if
absent. If present, the value MUST match the <code>dataschemauri</code> attribute of the
message definition.</li>
<li>The <code>type</code> of the property definition defaults to the CloudEvents type
definition for the attribute, if any. The <code>type</code> of an attribute MAY be
modified be to further constrained. For instance, the <code>source</code> type
<code>urireference</code> MAY be changed to
<code>uritemplate</code> or the <code>subject</code> type <code>string</code> MAY be constrained to a
<code>urireference</code> or <code>stringified integer</code>. If no CloudEvents type definition
exists, the default value MUST be <code>string</code>.</li>
</ul>

<p>The values of all <code>string</code> and <code>uritemplate</code>-typed attributes MAY contain
placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1 URI Template syntax. When the
same placeholder is used in multiple properties, the value of the placeholder is
assumed to be identical.</p>

<p>The following shows the format of a CloudEvents &ldquo;envelopemetadata&rdquo; section for
a message (see the <a href="model.json">model file</a> for the complete definition):</p>

<pre><code class="language-yaml">&quot;envelope&quot;: &quot;CloudEvents/1.0&quot;,
&quot;envelopemetadata&quot; {
  # &quot;CloudEvents/1.0&quot; envelope metadata
  &quot;specversion&quot;: {
    &quot;value&quot;: &quot;1.0&quot;,
    &quot;type&quot;: &quot;string&quot;
  },
  &quot;id&quot;: {
    &quot;value&quot;: &quot;STRING&quot;, ?
    &quot;type&quot;: &quot;string&quot;, ?
  },
  &quot;type&quot;: {
    &quot;value&quot;: &quot;STRING&quot;, ?
    &quot;type&quot;: &quot;string&quot;, ?
  },
  &quot;source&quot;: {
    &quot;value&quot;: &quot;STRING&quot;, ?
    &quot;type&quot;: &quot;string&quot;, ?
  },
  &quot;subject&quot;: {
    &quot;value&quot;: &quot;STRING&quot;, ?
    &quot;type&quot;: &quot;string&quot; ?
  },
  &quot;time&quot;: {
    &quot;value&quot;: &quot;TIME&quot;, ?
    &quot;type&quot;: &quot;timestamp&quot; ?
  },
  &quot;dataschema&quot;: {
    &quot;value&quot;: &quot;URITEMPLATE&quot;, ?
    &quot;type&quot;: &quot;uritemplate&quot; ?
  },
  &quot;*&quot;: {
    &quot;value&quot;: ANY, ?
    &quot;type&quot;: &quot;TYPE&quot;
  }
}
</code></pre>

<p>The following example declares a CloudEvent with a JSON payload. The attribute
<code>id</code> is REQUIRED in the declared event per the CloudEvents specification in
spite of such a declaration being absent here, the <code>type</code> of the <code>type</code>
attribute is <code>string</code> and the attribute is <code>required</code> even though the
declarations are absent. The <code>time</code> attribute is made <code>required</code> contrary to the
CloudEvents base specification. The implied CloudEvents <code>datacontenttype</code>
attribute value is <code>application/json</code> and the implied CloudEvents <code>dataschema</code>
attribute value is <code>https://example.com/schemas/com.example.myevent.json</code>:</p>

<pre><code class="language-yaml">{
  &quot;envelope&quot;: &quot;CloudEvents/1.0&quot;,
  &quot;envelopemetadata&quot;: {
    &quot;type&quot;: {
      &quot;value&quot;: &quot;com.example.myevent&quot;
    },
    &quot;source&quot;: {
      &quot;value&quot;: &quot;https://{tenant}/{module}/myevent&quot;,
      &quot;type&quot;: &quot;uritemplate&quot;
    },
    &quot;subject&quot;: {
      &quot;type&quot;: &quot;urireference&quot;
    },
    &quot;time&quot;: {
      &quot;required&quot;: true
    },
  },
  &quot;dataschemaformat&quot;: &quot;JsonSchema/draft-07&quot;,
  &quot;dataschemauri&quot;: &quot;https://example.com/schemas/com.example.myevent.json&quot;,
}
</code></pre>

<p>For clarity of the definition, you MAY always declare all implied attribute
properties explicitly, but they MUST conform with the rules above.</p>

<h4>Message Protocols</h4>

<h5>&ldquo;HTTP/1.1&rdquo;, &ldquo;HTTP/2&rdquo;, &ldquo;HTTP/3&rdquo; protocols</h5>

<p>The &ldquo;HTTP&rdquo; protocol is used to define messages that are sent over an HTTP
connection. The protocol is based on the
<a href="https://www.rfc-editor.org/rfc/rfc9110#section-6">HTTP Message Format</a> and is common across all versions of
HTTP.</p>

<p>The <a href="#protocoloptions"><code>protocoloptions</code></a> object MAY contain several
properties:</p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>headers</code></td>
<td>Array</td>
<td>The HTTP headers. See below.</td>
</tr>

<tr>
<td><code>query</code></td>
<td>Map</td>
<td>The HTTP query parameters.</td>
</tr>

<tr>
<td><code>path</code></td>
<td><code>uritemplate</code></td>
<td>The HTTP path.</td>
</tr>

<tr>
<td><code>method</code></td>
<td><code>string</code></td>
<td>The HTTP method</td>
</tr>

<tr>
<td><code>status</code></td>
<td><code>string</code></td>
<td>The HTTP status code</td>
</tr>
</tbody>
</table>
<p>HTTP allows for multiple headers with the same name. The <code>headers</code> property is
therefore an array of objects with <code>name</code> and <code>value</code> properties. The <code>name</code>
property is a string that MUST be a valid HTTP header name.</p>

<p>The <code>query</code> property is a map of string keys to string values.</p>

<p>The <code>path</code> property is a URI template.</p>

<p>The <code>method</code> property is a string that MUST be a valid HTTP method.</p>

<p>The <code>status</code> property is a string that MUST be a valid HTTP response
code. The <code>status</code> and <code>method</code> properties are mutually exclusive and
MUST NOT be present at the same time.</p>

<p>The values of all <code>string</code> and <code>uritemplate</code>-typed properties and headers and
query elements MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1 URI
Template syntax. When the same placeholder is used in multiple properties, the
value of the placeholder is assumed to be identical.</p>

<p>The following example defines a message that is sent over HTTP/1.1:</p>

<pre><code class="language-yaml">{
  &quot;protocol&quot;: &quot;HTTP&quot;,
  &quot;protocoloptions&quot;: {
    &quot;headers&quot;: [
      {
        &quot;name&quot;: &quot;Content-Type&quot;,
        &quot;value&quot;: &quot;application/json&quot;
      }
    ],
    &quot;query&quot;: [
      {
        &quot;name&quot;: &quot;foo&quot;,
        &quot;value&quot;: &quot;bar&quot;
      }
    ],
    &quot;path&quot;: &quot;/foo/{bar}&quot;,
    &quot;method&quot;: &quot;POST&quot;
  },
  &quot;dataschemaformat&quot;: &quot;JsonSchema/draft-07&quot;,
  &quot;dataschemauri&quot;: &quot;https://example.com/schemas/com.example.myevent.json&quot;,
}
</code></pre>

<h5>&ldquo;AMQP/1.0&rdquo; protocol</h5>

<p>The &ldquo;AMQP/1.0&rdquo; protocol is used to define messages that are sent over an
<a href="https://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html">AMQP</a> connection. It is based on the default
<a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#section-message-format">AMQP 1.0 Message Format</a>.</p>

<p>The <a href="#protocoloptions"><code>protocoloptions</code></a> object MAY contain several
properties, each of which corresponds to a section of the AMQP 1.0 Message:</p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>properties</code></td>
<td>Map</td>
<td>The AMQP 1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-properties">Message Properties</a> section.</td>
</tr>

<tr>
<td><code>application-properties</code></td>
<td>Map</td>
<td>The AMQP 1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-application-properties">Application Properties</a> section.</td>
</tr>

<tr>
<td><code>message-annotations</code></td>
<td>Map</td>
<td>The AMQP 1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-message-annotations">Message Annotations</a> section.</td>
</tr>

<tr>
<td><code>delivery-annotations</code></td>
<td>Map</td>
<td>The AMQP 1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-delivery-annotations">Delivery Annotations</a> section.</td>
</tr>

<tr>
<td><code>header</code></td>
<td>Map</td>
<td>The AMQP 1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-header">Message Header</a> section.</td>
</tr>

<tr>
<td><code>footer</code></td>
<td>Map</td>
<td>The AMQP 1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-footer">Message Footer</a> section.</td>
</tr>
</tbody>
</table>
<p>As in AMQP, all sections and properties are OPTIONAL.</p>

<p>The values of all <code>string</code>, <code>symbol</code>, <code>uri</code>, and <code>uritemplate</code>-typed properties
MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1 URI Template
syntax. When the same placeholder is used in multiple properties, the value of
the placeholder is assumed to be identical.</p>

<p>Example for an AMQP 1.0 message type that declares a fixed <code>subject</code> (analogous
to CloudEvents&rsquo; <code>type</code>), a custom property, and a <code>content-type</code> of
<code>application/json</code> without declaring a schema reference in the message
definition:</p>

<pre><code class="language-yaml">{
  &quot;protocol&quot;: &quot;AMQP/1.0&quot;,
  &quot;protocoloptions&quot;: {
    &quot;properties&quot;: {
      &quot;message-id&quot;: {
        &quot;required&quot;: true
      },
      &quot;to&quot;: {
        &quot;value&quot;: &quot;https://{host}/{queue}&quot;
      },
      &quot;subject&quot;: {
        &quot;value&quot;: &quot;MyMessageType&quot;,
        &quot;required&quot;: true
      },
      &quot;content-type&quot;: {
        &quot;value&quot;: &quot;application/json&quot;
      },
      &quot;content-encoding&quot;: {
        &quot;value&quot;: &quot;gzip&quot;
      }
    },
    &quot;application-properties&quot;: {
      &quot;my-application-property&quot;: {
        &quot;value&quot;: &quot;my-application-property-value&quot;
      }
    }
  }
}
</code></pre>

<h5><code>properties</code> (AMQP 1.0)</h5>

<p>The <code>properties</code> property is an object that contains the fixed properties of the
AMQP 1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-properties">Message Properties</a> section. The
following properties are defined, with type constraints:</p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>message-id</code></td>
<td>(see note below)</td>
<td>uniquely identifies a message within the message system</td>
</tr>

<tr>
<td><code>user-id</code></td>
<td><code>binary</code></td>
<td>identity of the user responsible for producing the message</td>
</tr>

<tr>
<td><code>to</code></td>
<td><code>uritemplate</code></td>
<td>address of the node to send the message to</td>
</tr>

<tr>
<td><code>subject</code></td>
<td><code>string</code></td>
<td>message subject</td>
</tr>

<tr>
<td><code>reply-to</code></td>
<td><code>uritemplate</code></td>
<td>address of the node to which the receiver of this message ought to send replies</td>
</tr>

<tr>
<td><code>correlation-id</code></td>
<td><code>string</code></td>
<td>client-specific id that can be used to mark or identify messages between clients</td>
</tr>

<tr>
<td><code>content-type</code></td>
<td><code>symbol</code></td>
<td>MIME content type for the message</td>
</tr>

<tr>
<td><code>content-encoding</code></td>
<td><code>symbol</code></td>
<td>MIME content encoding for the message</td>
</tr>

<tr>
<td><code>absolute-expiry-time</code></td>
<td><code>timestamp</code></td>
<td>time when this message is considered expired</td>
</tr>

<tr>
<td><code>group-id</code></td>
<td><code>string</code></td>
<td>group this message belongs to</td>
</tr>

<tr>
<td><code>group-sequence</code></td>
<td><code>integer</code></td>
<td>position of this message within its group</td>
</tr>

<tr>
<td><code>reply-to-group-id</code></td>
<td><code>uritemplate</code></td>
<td>group-id to which the receiver of this message ought to send replies to</td>
</tr>
</tbody>
</table>
<p>The <code>message-id</code> permits the types <code>ulong</code>, <code>uuid</code>, <code>binary</code>, <code>string</code>, and
<code>uritemplate</code>. A <code>value</code> constraint for <code>message-id</code> property SHOULD NOT be defined in
the message definition except for the case where the <code>message-id</code> is a <code>uritemplate</code>.</p>

<h5><code>application-properties</code> (AMQP 1.0)</h5>

<p>The <code>application-properties</code> property is a map that contains the custom
properties of the AMQP 1.0 [Application Properties]<a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-application-properties">AMQP 1.0 Application
Properties</a> section.</p>

<p>The names of the properties MUST be of type <code>symbol</code> and MUST be unique.
The values of the properties MAY be of any permitted type.</p>

<h5><code>message-annotations</code> (AMQP 1.0)</h5>

<p>The <code>message-annotations</code> property is a map that contains the custom
properties of the AMQP 1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-message-annotations">Message Annotations</a>
section.</p>

<p>The names of the properties MUST be of type <code>symbol</code> and MUST be unique.
The values of the properties MAY be of any permitted type.</p>

<h5><code>delivery-annotations</code> (AMQP 1.0)</h5>

<p>The <code>delivery-annotations</code> property is a map that contains the custom
properties of the AMQP 1.0
<a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-delivery-annotations">Delivery Annotations</a> section.</p>

<p>The names of the properties MUST be of type <code>symbol</code> and MUST be unique.
The values of the properties MAY be of any permitted type.</p>

<h6><code>header</code> (AMQP 1.0)</h6>

<p>The <code>header</code> property is an object that contains the properties of the
AMQP 1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-header">Message Header</a> section. The
following properties are defined, with type constraints:</p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>durable</code></td>
<td><code>boolean</code></td>
<td>specify durability requirements</td>
</tr>

<tr>
<td><code>priority</code></td>
<td><code>integer</code></td>
<td>relative message priority</td>
</tr>

<tr>
<td><code>ttl</code></td>
<td><code>integer</code></td>
<td>message time-to-live in milliseconds</td>
</tr>

<tr>
<td><code>first-acquirer</code></td>
<td><code>boolean</code></td>
<td>indicates whether the message has not been acquired previously</td>
</tr>

<tr>
<td><code>delivery-count</code></td>
<td><code>integer</code></td>
<td>number of prior unsuccessful delivery attempts</td>
</tr>
</tbody>
</table>

<h6><code>footer</code> (AMQP 1.0)</h6>

<p>The <code>footer</code> property is a map that contains the custom properties of the AMQP
1.0 <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-footer">Message Footer</a> section.</p>

<p>The names of the properties MUST be of type <code>symbol</code> and MUST be unique.
The values of the properties MAY be of any permitted type.</p>

<h5>&ldquo;MQTT/3.1.1&rdquo; and &ldquo;MQTT/5.0&rdquo; protocols</h5>

<p>The &ldquo;MQTT/3.1.1&rdquo; and &ldquo;MQTT/5.0&rdquo; protocols are used to define messages that are
sent over <a href="https://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html">MQTT 3.1.1</a> or <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/mqtt-v5.0.html">MQTT 5.0</a> connections. The
format describes the <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/mqtt-v5.0.html">MQTT PUBLISH packet</a> content.</p>

<p>The <a href="#protocoloptions"><code>protocoloptions</code></a> object contains the elements of the
MQTT PUBLISH packet directly, with the <code>user-properties</code> element corresponding
to the application properties collection of other protocols.</p>

<p>The following properties are defined. The MQTT 3.1.1 and MQTT 5.0 columns
indicate whether the property is supported for the respective MQTT version.</p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>MQTT 3.1.1</th>
<th>MQTT 5.0</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>qos</code></td>
<td><code>integer</code></td>
<td>yes</td>
<td>yes</td>
<td>Quality of Service level</td>
</tr>

<tr>
<td><code>retain</code></td>
<td><code>boolean</code></td>
<td>yes</td>
<td>yes</td>
<td>Retain flag</td>
</tr>

<tr>
<td><code>topic_name</code></td>
<td><code>string</code></td>
<td>yes</td>
<td>yes</td>
<td>Topic name</td>
</tr>

<tr>
<td><code>payload_format</code></td>
<td><code>integer</code></td>
<td>no</td>
<td>yes</td>
<td>Payload format indicator</td>
</tr>

<tr>
<td><code>message_expiry_interval</code></td>
<td><code>integer</code></td>
<td>no</td>
<td>yes</td>
<td>Message expiry interval</td>
</tr>

<tr>
<td><code>response_topic</code></td>
<td><code>uritemplate</code></td>
<td>no</td>
<td>yes</td>
<td>Response topic</td>
</tr>

<tr>
<td><code>correlation_data</code></td>
<td><code>binary</code></td>
<td>no</td>
<td>yes</td>
<td>Correlation data</td>
</tr>

<tr>
<td><code>content_type</code></td>
<td><code>symbol</code></td>
<td>no</td>
<td>yes</td>
<td>MIME content type of the payload</td>
</tr>

<tr>
<td><code>user_properties</code></td>
<td>Array</td>
<td>no</td>
<td>yes</td>
<td>User properties</td>
</tr>
</tbody>
</table>
<p>Like HTTP, the MQTT allows for multiple user properties with the same name,
so the <code>user_properties</code> property is an array of objects, each of which
contains a single property name and value.</p>

<p>The values of all <code>string</code>, <code>symbol</code>, and <code>uritemplate</code>-typed properties and
user properties MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1
URI Template syntax. When the same placeholder is used in multiple properties,
the value of the placeholder is assumed to be identical.</p>

<p>The following example shows a message with the &ldquo;MQTT/5.0&rdquo; protocol, asking for
QoS 1 delivery, with a topic name of &ldquo;mytopic&rdquo;, and a user property of
&ldquo;my-application-property&rdquo; with a value of &ldquo;my-application-property-value&rdquo;:</p>

<pre><code class="language-yaml">{
  &quot;protocol&quot;: &quot;MQTT/5.0&quot;,
  &quot;protocoloptions&quot;: {
    &quot;qos&quot;: 1,
    &quot;retain&quot;:  false,
    &quot;topic_name&quot;: &quot;mytopic&quot;,
    &quot;user_properties&quot;: [
      {
        &quot;name&quot;: &quot;My Application Property&quot;,
        &quot;value&quot;: &quot;Value 1&quot;
      }
    ]
  }
}
</code></pre>

<h3>&ldquo;KAFKA&rdquo; protocol</h3>

<p>The &ldquo;KAFKA&rdquo; protocol is used to define messages that are sent using the <a href="https://kafka.apache.org/protocol">Apache
Kafka</a> RPC protocol.</p>

<p>The <a href="#protocoloptions"><code>protocoloptions</code></a> object contains the common elements
of the Kafka <a href="https://kafka.apache.org/31/javadoc/org/apache/kafka/clients/producer/ProducerRecord.html">producer</a> and
<a href="https://kafka.apache.org/31/javadoc/org/apache/kafka/clients/consumer/ConsumerRecord.html">consumer</a> records, with the <code>headers</code> element
corresponding to the application properties collection of other protocols.</p>

<p>The following properties are defined:</p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>topic</code></td>
<td><code>string</code></td>
<td>The topic the record will be appended to</td>
</tr>

<tr>
<td><code>partition</code></td>
<td><code>integer</code></td>
<td>The partition to which the record is to be sent or has been received from</td>
</tr>

<tr>
<td><code>key</code></td>
<td><code>string</code></td>
<td>The key that is associated with the record, UTF-8 encoded</td>
</tr>

<tr>
<td><code>key_base64</code></td>
<td><code>binary</code></td>
<td>The key that is associated with the record as a base64 encoded string</td>
</tr>

<tr>
<td><code>headers</code></td>
<td>Map</td>
<td>A map of headers to set on the record</td>
</tr>
</tbody>
</table>
<p>The <code>key</code> and <code>key_base64</code> properties are mutually exclusive and MUST NOT be
present at the same time.</p>

<p>The <code>partition</code> property is included because there are cases where applications
use partitions explicitly for addressing and routing messages within the scope
of a topic.</p>

<p>The values of all <code>string</code>, <code>symbol</code>, <code>uritemplate</code>-typed properties
and headers MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1 URI
Template syntax. When the same placeholder is used in multiple properties, the
value of the placeholder is assumed to be identical.</p>

<p>Example:</p>

<pre><code class="language-yaml">{
  &quot;protocol&quot;: &quot;Kafka&quot;,
  &quot;protocoloptions&quot;: {
    &quot;topic&quot;: &quot;mytopic&quot;,
    &quot;key&quot;: &quot;thisdevice&quot;
  }
}
</code></pre>

<h3>&ldquo;NATS&rdquo; protocol</h3>

<p>The &ldquo;NATS&rdquo; protocol is used to define messages that are sent using the <a href="https://docs.nats.io/reference/reference-protocols/nats-protocol">NATS</a> protocol.</p>

<p>The <a href="#protocoloptions"><code>protocoloptions</code></a> object contains the available elements
of the NATS message for the <code>HPUB</code> operation.</p>

<p>The following properties are defined:</p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>subject</code></td>
<td><code>uritemplate</code></td>
<td>The subject the message will be published to</td>
</tr>

<tr>
<td><code>reply-to</code></td>
<td><code>uritemplate</code></td>
<td>The subject the receiver ought to reply to</td>
</tr>

<tr>
<td><code>headers</code></td>
<td>Array</td>
<td>A list of headers to set on the message</td>
</tr>
</tbody>
</table>
<p>The values of all <code>string</code>, <code>symbol</code>, <code>uritemplate</code>-typed properties
and headers MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1 URI
Template syntax. When the same placeholder is used in multiple properties, the
value of the placeholder is assumed to be identical.</p>

<p>Example:</p>

<pre><code class="language-yaml">{
  &quot;protocol&quot;: &quot;NATS&quot;,
  &quot;protocoloptions&quot;: {
    &quot;subject&quot;: &quot;mytopic&quot;,
    &quot;reply-to&quot;: &quot;replytopic&quot;
  }
}
</code></pre>
